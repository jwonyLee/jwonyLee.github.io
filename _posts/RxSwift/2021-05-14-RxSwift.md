---
layout: post
title: RxSwift í•™ìŠµ ì •ë¦¬
subtitle: 
categories: RxSwift
tags: [RxSwift]
emoji: ğŸ
---


## ì˜µì €ë²„ íŒ¨í„´

-   1:N ê´€ê³„ë¡œ ì´ë£¨ì–´ì§„, ê´€ì°° íŒ¨í„´
-   ê°ì²´ë¥¼ êµ¬ë…í•˜ë©´ ì˜µì €ë²„ê°€ ìƒíƒœë¥¼ ì•Œë ¤ì¤Œ  
    ![Observer Pattern](/assets/image/rxswift-1.png)

## í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°

-   1ê¸‰ ê°ì²´
    -   ë³€ìˆ˜ë‚˜ ìƒìˆ˜ì— ì €ì¥ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•¨
    -   í•¨ìˆ˜ì—ì„œ `return` í•  ìˆ˜ ìˆì–´ì•¼ í•¨
    -   íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆì–´ì•¼ í•¨
-   ìˆœìˆ˜ í•¨ìˆ˜
-   ```swift
    /* í™˜ìœ¨ ê³„ì‚°í•´ì£¼ëŠ” í”„ë¡œê·¸ë¨ ì´ ì½”ë“œëŠ” ìˆœìˆ˜ í•¨ìˆ˜ë¼ê³  í•  ìˆ˜ ì—†ë‹¤. â†’ ì „ì—­ ìƒíƒœì— ì˜ì¡´ = ì°¸ì¡° íˆ¬ëª…ì„±ì´ ì—†ë‹¤ */ 
    var rate = 1120 
    func krw(usd: Int) -> Int { 
    	return usd * rate 
    } 
    
    krw(usd: 2) // 2240 
    krw(usd: 3) // 3360 
    rate = 1130 
    krw(usd: 2) // 2260 
    krw(usd: 3) // 3390
    ```
    

## ReactiveX

-   ê´€ì°° ê°€ëŠ¥í•œ ìŠ¤íŠ¸ë¦¼ì„ ì´ìš©í•œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° API
-   Reactive eXtension

## RxSwift

-   Observable
    -   Rxì˜ ê¸°ë³¸ì´ ë˜ëŠ” ìŠ¤íŠ¸ë¦¼ì„ ê°€ì§€ê³  ìˆëŠ” ê¸°ë³¸ ì‹œí€€ìŠ¤
    -   í•˜ë‚˜ ë˜ëŠ” ì—°ì†ëœ í•­ëª©ì„ ë°°ì¶œ
    -   êµ¬ë… í›„ next, error, completedë¡œ ì²˜ë¦¬
        -   next ìŠ¤íŠ¸ë¦¼
            -   ì—°ì†ëœ ê°’ë“¤ì„ ë°°ì¶œí•˜ê³  ì˜µì €ë²„ëŠ” next ìŠ¤íŠ¸ë¦¼ì„ ê´€ì°° ë° êµ¬ë…í•´ì„œ ì›í•˜ëŠ” í–‰ë™ì„ í•¨
        -   error ìŠ¤íŠ¸ë¦¼
            -   ê°’ì„ ë°°ì¶œí•˜ë‹¤ê°€ ì—ëŸ¬ê°€ ìƒê¸°ë©´ errorë¥¼ ë°°ì¶œí•œ ë‹¤ìŒ í•´ë‹¹ Observableì€ ìŠ¤íŠ¸ë¦¼ì„ ë©ˆì¶¤
        -   complete
            -   Observableì´ ëª¨ë“  ê°’ì„ ë‹¤ ë°°ì¶œí•˜ë©´ ì´ ìƒíƒœ(?)ê°€ ë¨
            -   errorê°€ ë°œìƒí•˜ë©´ completeì€ ë°œìƒí•˜ì§€ ì•ŠìŒ!
-   Operator
    -   Observable ì•ˆì—ì„œ ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ ëª¨ë“  ì—°ì‚°ë“¤
    -   map, filter, merge ë“± ìˆ˜ì‹­ê°€ì§€ì˜ ì—°ì‚°ì´ ìˆìŒ
        -   ë©”ì†Œë“œ ì²´ì´ë‹ìœ¼ë¡œ ë§ì´ ì§„í–‰í•¨
-   Single
    -   Observable ê°™ì´ Në²ˆì´ ì•„ë‹Œ, ë‹¨ë²ˆì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ì‹œí€€ìŠ¤
    -   êµ¬ë… í›„ success, error ë‘ ê°€ì§€ë¡œ ì²˜ë¦¬
    -   í•œë²ˆë§Œ ì˜¤ê³ , í•œë²ˆì— ëë‚¨
-   Subject
    -   ì—¬ëŸ¬ê°œì˜ Observerê°€ ë°ì´í„°ë¥¼ ê´€ì°°í•´ì•¼ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´
    -   Observer ì™€ Observable ì‚¬ì´ì˜ ë¸Œë¦¿ì§€ ì—­í• 
    -   ì—¬ëŸ¬ ê°œì˜ Observerê°€ ë°ì´í„°ë¥¼ ê´€ì°°í•´ì•¼í•˜ëŠ” ê²½ìš° ìì£¼ ì“°ì„

## êµ³ì´?

-   ì™œ ë¹„ìš©ì„ ë“¤ì—¬ê°€ë©´ì„œ?
-   ì™œ ì˜ ëŒì•„ê°€ëŠ” ì½”ë“œë¥¼ ë°”ê¿”ê°€ë©´ì„œ?
-   ì™œ ê¼­ ë” ë‚œì´ë„ ìˆëŠ” RxSwiftë¥¼?

### ì´ìœ 

-   ê°„ê²°í•´ì§€ëŠ” ì½”ë“œ
    -   ì¡°ê¸ˆ ë” ê¸¸ì–´ì§€ë”ë¼ë„, ê°„ë‹¨í•˜ë©´ì„œë„ ê¹”ë”í•´ì§€ëŠ” ì½”ë“œ
-   ê°„í¸í•œ ë¹„ë™ê¸° ê´€ë¦¬

## RxSwift ì•Œì•„ë³´ê¸° 1 ~ 3 ê¸°ë¡

### ì •ìˆ˜í˜• ë°°ì—´ì˜ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì²´í¬í•˜ëŠ” í•¨ìˆ˜ (RxSwift)

```swift
// items ë¼ëŠ” ì •ìˆ˜ íƒ€ì…ì˜ ë°°ì—´ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ -> ì •ìˆ˜ ì œë„¤ë¦­ íƒ€ì…ì˜ Observable ê°ì²´ë¥¼ ë¦¬í„´
func checkArrayObservable(items: [Int]) -> Observable<Int> {
    return Observable<Int>.create { observer -> Disposable in

        for item in items {
            if item == 0 {
                observer.onError(NSError(domain: "Error: value is zero.", code: 0, userInfo: nil)) // 0ì´ë©´ ì—ëŸ¬ë¥¼ í˜ë ¤ì¤€ë‹¤
                break
            }

            observer.onNext(item) // 0ì´ ì•„ë‹ˆë©´ ê° ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ nextë¡œ í˜ë ¤ì¤€ë‹¤

            sleep(1)
        }

        observer.onCompleted() // ëª¨ë“  ìˆœíšŒê°€ ëë‚˜ë©´ completed ë˜ì—ˆë‹¤ëŠ” ê±¸ ì•Œë¦¼

        return Disposables.create()
    }
}
```

### Subscribe, Dispose

#### Subscribe

`Observable`ì˜ streamì„ ê´€ì°°í•˜ê³  êµ¬ë…í•´ì„œ ë°›ëŠ” ì—­í• 

â†’ `Disposable` ì´ë¼ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤!

#### ì˜ˆì œ ì½”ë“œ

```swift
// interval: nì´ˆë§ˆë‹¤ ì •ìˆ˜ íƒ€ì…ì˜ ìŠ¤íŠ¸ë¦¼ì´ ë°©ì¶œë¨
Observable<Int>.interval(RxTimeInterval.seconds(1), scheduler: MainScheduler.instance)
    .take(10) // parameter ë§Œí¼ì˜ ìŠ¤íŠ¸ë¦¼ í—ˆìš©
    .subscribe(onNext: { value in
        print(value)
    }, onError: { error in
        print(error)
    }, onCompleted: {
        print("onCompleted")
    }, onDisposed: {
        print("onDisposed")
    })

// ì˜ˆì™¸ ìƒí™© ë°œìƒ
// ì¹´ìš´íŒ…ì´ ëë‚˜ê¸° ì „ì— ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í•´ì œí•´ ë²„ë¦°ë‹¤ë©´?
DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
    UIApplication.shared.keyWindow?.rootViewController = nil
} // ì•±ì´ ì£½ì—ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ëê¹Œì§€ ì¹´ìš´íŠ¸ê°€ ì§„í–‰ë¨
```

ì´ê²ƒì„ í•´ê²°í•´ë³´ì.

#### Disposable

> disposable: ì²˜ë¶„í•  ìˆ˜ ìˆëŠ”, ì‚¬ìš© í›„ ë²„ë¦´ ìˆ˜ ìˆëŠ”

```swift
public protocol Disposable {
    /// Dispose resource.
    func dispose()
}
```

```swift
// interval: nì´ˆë§ˆë‹¤ ì •ìˆ˜ íƒ€ì…ì˜ ìŠ¤íŠ¸ë¦¼ì´ ë°©ì¶œë¨
let disposable = Observable<Int>.interval(RxTimeInterval.seconds(1), scheduler: MainScheduler.instance)
    .take(10) // parameter ë§Œí¼ì˜ ìŠ¤íŠ¸ë¦¼ í—ˆìš©
    .subscribe(onNext: { value in
        print(value)
    }, onError: { error in
        print(error)
    }, onCompleted: {
        print("onCompleted")
    }, onDisposed: {
        print("onDisposed")
    })

// ì˜ˆì™¸ ìƒí™© ë°œìƒ
// ì¹´ìš´íŒ…ì´ ëë‚˜ê¸° ì „ì— ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í•´ì œí•´ ë²„ë¦°ë‹¤ë©´?
DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
    disposable.dispose()
} // ë°˜í™˜ëœ disposable ê°ì²´ë¥¼ ê°€ì§€ê³  ìˆë‹¤ê°€ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ê°€ deinit ë  ë•Œ dispose ì‹¤í–‰
```

#### ë§Œì•½ êµ¬ë…ë°›ëŠ” Observableì´ ì—¬ëŸ¬ê°œë¼ë©´?

â†’ DisposeBagì„ ì‚¬ìš©í•˜ì

```swift
extension Disposable {
    /// Adds `self` to `bag`
    ///
    /// - parameter bag: `DisposeBag` to add `self` to.
    public func disposed(by bag: DisposeBag) {
        bag.insert(self)
    }
}
```

íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ì˜¤ëŠ” DisposeBag ê°ì²´ì— ìì‹ ì„ insert í•œë‹¤.

ëª¨ë“  `Disposable` ê°ì²´ì— `disposed`ë¥¼ í•´ì£¼ë©´ í•´ë‹¹ íŒŒë¼ë¯¸í„°ì¸ `disposeBag`ì— ë“±ë¡ë˜ê³  **disposeBag ê°ì²´ê°€ í•´ì œë˜ë©´ì„œ ë“±ë¡ëœ ëª¨ë“  disposableì´ ë‹¤ ê°™ì´ dispose ë˜ì–´ë²„ë¦°ë‹¤.**

```swift
/// varë¡œ ì„ ì–¸í•œ ì´ìœ : disposeBagì´ í•´ì œë˜ë©´ ëª¨ë“  disposableì´ disposeë˜ëŠ” ì›ë¦¬ë¥¼ ê°œë°œë„ì¤‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
/// subscribe ì¤‘ì´ë˜ disposableì„ ì´ˆê¸°í™”í•˜ê³  ì‹¶ìœ¼ë©´ ìƒˆë¡œìš´ DisposeBag ê°ì²´ë¥¼ ë„£ì–´ì£¼ë©´ ë!
var disposeBag = DisposeBag()

// interval: nì´ˆë§ˆë‹¤ ì •ìˆ˜ íƒ€ì…ì˜ ìŠ¤íŠ¸ë¦¼ì´ ë°©ì¶œë¨
Observable<Int>.interval(RxTimeInterval.seconds(1), scheduler: MainScheduler.instance)
    .take(10) // parameter ë§Œí¼ì˜ ìŠ¤íŠ¸ë¦¼ í—ˆìš©
    .subscribe(onNext: { value in
        print(value)
    }, onError: { error in
        print(error)
    }, onCompleted: {
        print("onCompleted")
    }, onDisposed: {
        print("onDisposed")
    })
    .disposed(by: disposeBag) // **â† ì—¬ê¸° ë¶€ë¶„!**
```

## RxSwift In 4Hours

### ë™ê¸°/ë¹„ë™ê¸° ì²˜ë¦¬

```swift
@IBAction func onLoadAsync(_ sender: Any) {
    // TODO: async
    DispatchQueue.global().async { [weak self] in
        guard let self = self else { return }
        let image = self.loadImage(from: self.IMAGE_URL)
        DispatchQueue.main.async {
            self.imageView.image = image
        }
    }
}

private func loadImage(from imageUrl: String) -> UIImage? {
    guard let url = URL(string: imageUrl) else { return nil }
    guard let data = try? Data(contentsOf: url) else { return nil }

    let image = UIImage(data: data)
    return image
}
```

### just

```swift
Observable.just("Hello World")
    .subscribe(onNext: { str in
        print(str)
    })
    .disposed(by: disposeBag)
```

`just`ì˜ ì¸ìë¡œ ë„£ì–´ì¤€ `"Hello World"`ê°€ `str`ë¡œ ë„˜ì–´ê°„ë‹¤.

-   `Observable.create()`ë¥¼ ëŒ€ì‹  í•´ì£¼ëŠ” ë©”ì†Œë“œ
-   ë°°ì—´ì„ ë„£ìœ¼ë©´ ë°°ì—´ì„ ì²˜ë¦¬í•¨(ì•„ë¬´ê±°ë‚˜ ë„£ì–´ë„ ëœë‹¨ ì†Œë¦¬)

### from

```swift
Observable.from(["RxSwift", "In", "4", "Hours"])
    .subscribe(onNext: { str in
        print(str)
    })
    .disposed(by: disposeBag)
```

`from`ì— ë°°ì—´ì´ ë“¤ì–´ê°€ë©´ **í•˜ë‚˜ì”©** ì‹¤í–‰í•œë‹¤.

### map

```swift
Observable.just("Hello")
    .map { str in "\(str) RxSwift" }
    .subscribe(onNext: { str in
        print(str)
    })
    .disposed(by: disposeBag)
```

ì‹¤í–‰ìˆœì„œ

1.  `just(Hello)`
2.  `map { str in "\(str) RxSwift" }`
3.  `onNext: { str in print(str) }`
4.  ê²°ê³¼: Hello RxSwift

```swift
Observable.just(["Hello", "World"])
    .map { str in "\(str) RxSwift" }
    .subscribe(onNext: { str in
        print(str)
    })
    .disposed(by: disposeBag)
```

ì‹¤í–‰ìˆœì„œ

1.  `just(["Hello", "World"])`
2.  `map { str in "\(str) RxSwift" }`
3.  `onNext: { str in print(str) }`
4.  ê²°ê³¼: \["Hello", "World"\] RxSwift

```swift
Observable.from(["Hello", "World"])
    .map { str in "\(str) RxSwift" }
    .subscribe(onNext: { str in
        print(str)
    })
    .disposed(by: disposeBag)
```

ì‹¤í–‰ìˆœì„œ

1.  `just(["Hello", "World"])` â†’ ì²«ë²ˆì§¸ ì›ì†Œ
2.  `map { str in "\(str) RxSwift" }`
3.  `onNext: { str in print(str) }`
4.  ê²°ê³¼: Hello RxSwift
5.  `just(["Hello", "World"])` â†’ ë‘ë²ˆì§¸ ì›ì†Œ
6.  `map { str in "\(str) RxSwift" }`
7.  `onNext: { str in print(str) }`
8.  ê²°ê³¼: World RxSwift

### filter

```swift
Observable.from([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
    .filter { $0 % 2 == 0 }
    .subscribe(onNext: { n in
        print(n)
    })
    .disposed(by: disposeBag)
```

`true`ì¼ ë•Œë§Œ ë°ì´í„°ê°€ ë°‘ìœ¼ë¡œ ë‚´ë ¤ê°

### ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ëŠ” ê³¼ì •

ìœ„ì—ì„œ ë°°ìš´ ê±¸ë¡œ í•´ì„í•´ë³´ì.

```swift
Observable.just("800x600")
    .map { $0.replacingOccurrences(of: "x", with: "/") } // â†’ "800/600"
    .map { "https://picsum.photos/\($0)/?random" } // â†’ "https://picsum.photos/800/600/?random"
    .map { URL(string: $0) } // â†’ URL ê°ì²´ë¡œ ë³€í™˜
    .filter { $0 != nil } // â†’ URL ê°ì²´ê°€ nilì´ë©´ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ
    .map { $0! } // â†’ ë‚´ë ¤ì˜¤ë©´ ê°•ì œ ì–¸ë©í•‘ (ìœ„ì—ì„œ ì²´í¬í–ˆìœ¼ë‹ˆê¹Œ ê°•ì œ ì–¸ë˜í•‘í•´ë„ ë¨)
    .map { try Data(contentsOf: $0) } // â†’ URLì— ìˆëŠ” ë°ì´í„°ë¥¼ ë‹¤ìš´
    .map { UIImage(data: $0) } // â†’ UIImage?
    .subscribe(onNext: { image in
        self.imageView.image = image
    })
    .disposed(by: disposeBag)
```

### observeOn

```swift
Observable.just("800x600")
    .observeOn(ConcurrentDispatchQueueScheduler.init(qos: .default)) // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëŒë¦´ ë•Œ
    .map { $0.replacingOccurrences(of: "x", with: "/") } // â†’ "800/600"
    .map { "https://picsum.photos/\($0)/?random" } // â†’ "https://picsum.photos/800/600/?random"
    .map { URL(string: $0) } // â†’ URL ê°ì²´ë¡œ ë³€í™˜
    .filter { $0 != nil } // â†’ URL ê°ì²´ê°€ nilì´ë©´ ë‚´ë ¤ê°€ì§€ ì•ŠìŒ
    .map { $0! } // â†’ ë‚´ë ¤ì˜¤ë©´ ê°•ì œ ì–¸ë©í•‘ (ìœ„ì—ì„œ ì²´í¬í–ˆìœ¼ë‹ˆê¹Œ ê°•ì œ ì–¸ë˜í•‘í•´ë„ ë¨)
    .map { try Data(contentsOf: $0) } // â†’ URLì— ìˆëŠ” ë°ì´í„°ë¥¼ ë‹¤ìš´
    .map { UIImage(data: $0) } // â†’ UIImage?
    .observeOn(MainScheduler.instance) // ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ëŒë¦¬ëŠ”ê±°
    .subscribe(onNext: { image in
        self.imageView.image = image
    })
    .disposed(by: disposeBag)
```

`observeOn`ì„ í•´ì¤€ ë‹¤ìŒì¤„ ë¶€í„° ì˜í–¥ì´ ë¯¸ì¹œë‹¤.

### subscribeOn

`subscribe`ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ë¶€í„° ë™ì‘í•œë‹¤. ì•„ë¬´ ìœ„ì¹˜ì—ë‚˜ ë„£ì–´ë„ ìƒê´€ì—†ìŒ!

### side-effect

side-effectë¥¼ í—ˆìš©í•˜ëŠ” ê±´ ë‘ ê°œê°€ ìˆë‹¤.

-   do
-   subscribe

---

## ì°¸ê³  ìë£Œ

- [RxSwift + MVVM ì„¤ëª…](https://www.youtube.com/watch?v=3_dyVj4HcYk&feature=youtu.be)
- [\[RxSwift\] RxSwift ì‹œì‘í•˜ê¸°](https://medium.com/@jang.wangsu/rxswift-rxswift-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-4b5187d07a33)
- [RxSwift ì•Œì•„ë³´ê¸°(ReactiveX ì— ëŒ€í•´ì„œ) - 01](https://magi82.github.io/ios-rxswift-01/) â†’ ì‹œë¦¬ì¦ˆ ì°¸ê³ !
- [RxSwift 4ì‹œê°„ì— ëë‚´ê¸° (ì¢…í•©í¸)](https://www.youtube.com/watch?v=w5Qmie-GbiA&list=PL03rJBlpwTaAh5zfc8KWALc3ADgugJwjq&index=1)