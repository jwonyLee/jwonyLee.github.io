---
layout: wiki
title: '[iOS] Contacts í”„ë ˆì„ì›Œí¬ í†ºì•„ë³´ê¸°'
summary: 
permalink: 8b0a4b90-250f-9ea1-905c-c5c6ffd0f9cc
date: 2021-02-02
updated: 2021-02-02
tag: 
public: true
parent: 
latex: true
comment: true
---

* TOC
{:toc}

# \[iOS] Contacts í”„ë ˆì„ì›Œí¬ í†ºì•„ë³´ê¸°

## ê°œìš”

[Contacts](https://developer.apple.com/documentation/contacts) í”„ë ˆì„ì›Œí¬ í†ºì•„ë³´ê¸°

Contacts í”„ë ˆì„ì›Œí¬ ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì„œ ì‚¬ìš©ìì˜ ì—°ë½ì²˜ë¥¼ ê°€ì ¸ì™€ì„œ í…Œì´ë¸”ë·°ë¥¼ í†µí•´ ë³´ì—¬ì£¼ì.

## ğŸ”¨ ì‚¬ìš©ìì˜ ì—°ë½ì²˜ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì£¼ê¸°

UI êµ¬ì„±í•˜ëŠ” ë¶€ë¶„ì€ íŒ¨ìŠ¤. ì½”ë“œë‚˜ ìŠ¤í† ë¦¬ë³´ë“œë¡œ í…Œì´ë¸”ë·°ì™€ ì…€ êµ¬ì„±ì„ í•´ì£¼ë©´ ëœë‹¤. ì…€ì˜ ìŠ¤íƒ€ì¼ì€ `Subtitle`ë¡œ ì§€ì •í•´ì¤¬ë‹¤. ë°ì´í„°ë¥¼ ë§ì´ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì¤„ ê²Œ ì•„ë‹ˆë¼ì„œ ê°„ë‹¨í•˜ê²Œ í–ˆë‹¤.

ê·¸ë‹¤ìŒìœ¼ë¡œ Fetching Contacts ë¬¸ë‹¨ì— ìˆëŠ” ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¼ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```swift
override func viewDidLoad() {
    super.viewDidLoad()

    self.fetchContacts()
}

func fetchContacts() {
    let store = CNContactStore()
    do {
        let predicate = CNContact.predicateForContacts(matchingName: "Appleseed")
                let keysToFetch = [CNContactGivenNameKey, CNContactFamilyNameKey] as [CNKeyDescriptor]
        let contacts =
            try store.unifiedContacts(matching: predicate, keysToFetch: keysToFetch)
        print("Fetched contacts: \(contacts)")
    } catch {
        print("Failed to fetch contact, error: \(error)")
        // Handle the error
    }
}
```

![Error Message](contacts-1.png)

ì‹¤í–‰í•´ë³´ë©´ ìœ„ì™€ ê°™ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ì™œëƒí•˜ë©´ ì—°ë½ì²˜ëŠ” ê°œì¸ì •ë³´ì— í•´ë‹¹í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ìš”ì²­ë°›ì•„ì•¼ í•œë‹¤.

![Contacts Topics](contacts-2.png)

Contacts ë¬¸ì„œ í•˜ë‹¨ì—ëŠ” ê´€ë ¨ëœ í† í”½ì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ [Requesting Authorization to Access Contacts](https://developer.apple.com/documentation/contacts/requesting_authorization_to_access_contacts) ë¬¸ì„œë¥¼ ë³´ë©´ ëœë‹¤.

![Requesting Authorization to Access Contacts](contacts-3.png)

ì˜ì–´ë§Œ ë´ë„ ëˆˆì´ í•‘ ëŒì•„ê°„ë‹¤. @\_@...

ì•±ì€ ì‚¬ìš©ìê°€ ê¶Œí•œì„ ë¶€ì—¬í•  ë•Œê¹Œì§€ ì—°ë½ì²˜ í•­ëª©ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ë‹¤ê³  ì„¤ëª…í•˜ë©´ì„œ ì‚¬ìš©ìì—ê²Œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ `authorizationStatus(for:)` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë¼ê³  ì“°ì—¬ìˆë‹¤.

![Configure Your Information Property List File](contacts-4.png)

ì¡°ê¸ˆ ë” ë°‘ìœ¼ë¡œ ë‚´ë ¤ì„œ ì½ì–´ë³´ë©´, `Info.plist` íŒŒì¼ì— `NSContactsUsageDescription` í‚¤ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤ê³  ì“°ì—¬ìˆë‹¤. ì´ í‚¤ì˜ ê°’ì€ ì•±ì´ ì‚¬ìš©ìì˜ ì—°ë½ì²˜ë¡œ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ì„ ì„¤ëª…í•˜ëŠ” ë¬¸ìì—´ì´ë¼ê³  í•œë‹¤.

ê·¸ë¦¬ê³  ê·¸ ë‹¤ìŒìœ¼ë¡œëŠ” ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ìŠ¹ì¸ ìš”ì²­ì„ í•˜ëŠ” ë°©ë²•ì´ ì“°ì—¬ìˆë‹¤. `requestAccess(for:completionHandler:)` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤ê³  í•œë‹¤. í•„ìš”í•œ ì •ë³´ë¥¼ ì „ë¶€ ì•Œì•„ëƒˆìœ¼ë‹ˆ ë¬¸ì œë¥¼ ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” ëŒ€ë¡œ ì•±ì„ ìˆ˜ì •í•´ë³¸ë‹¤.

ë¨¼ì € `Info.plist` íŒŒì¼ì— `NSContactsUsageDescription` í‚¤ë¥¼ ì¶”ê°€í•´ì•¼ í•˜ëŠ”ë°, ì´ê²ƒë§Œ ë´ì„  ë­”ì§€ ëª¨ë¥¼ ê±° ê°™ì§€ë§Œ ì• í”Œì—ì„  ì¹œì ˆí•˜ê²Œ í•´ë‹¹ í‚¤ê°€ ì‹¤ì œë¡œ ë¬´ìŠ¨ ì´ë¦„ì„ ê°€ì¡ŒëŠ”ì§€ ë¬¸ì„œë¡œ ì œê³µí•˜ê³  ìˆë‹¤.

[https://developer.apple.com/documentation/bundleresources/information\_property\_list/nscontactsusagedescription](https://developer.apple.com/documentation/bundleresources/information_property_list/nscontactsusagedescription)

![NSContactsUsageDescription](contacts-5.png)

`Info.plist`ì— ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•´ì¤€ë‹¤. ì‚¬ìš©ìì—ê²Œ ì´ ê¶Œí•œì´ ì™œ í•„ìš”í•œì§€ ì„¤ëª…ì„ ê¸°ë¡í•´ì•¼ í•œë‹¤.

ì´ë ‡ê²Œ í•œ ë‹¤ìŒì— ë°”ë¡œ ì—°ë½ì²˜ì— ì ‘ê·¼í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ `requestAccess(for:completionHandler:)`ë¥¼ ì´ìš©í•´ ì‚¬ìš©ìì—ê²Œ ìŠ¹ì¸ ìš”ì²­ì„ í•œë‹¤. ê¶Œí•œì´ ìˆìœ¼ë©´ ì—°ë½ì²˜ì— ì ‘ê·¼í•˜ê³ , ì—†ìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ìš”ì²­ì„ í•œë‹¤.

```swift
let store = CNContactStore()

override func viewDidLoad() {
    super.viewDidLoad()

    self.requestCNContactStoreAccess {
        // ìŠ¹ì¸ ìš”ì²­ ì„±ê³µì‹œ í•  ì‘ì—…
        fetchContacts()
        DispatchQueue.main.async {
            self.tableView.reloadData()
        }
    }
}

func requestCNContactStoreAccess(completion: @escaping () -> Void) {
    self.store.requestAccess(for: .contacts) { (granted, error) in
        // ì—ëŸ¬ ë°œìƒ
        if let error = error {
            print(error.localizedDescription)
            return
        }

        // ì‚¬ìš©ìì—ê²Œ ìŠ¹ì¸ ìš”ì²­ ì„±ê³µì‹œ íƒˆì¶œ
        if granted {
            completion()
        }
    }
}
```

ì´ ê³¼ì •ì—ì„œ `fetchContacts`ì— ìˆë˜ `store` ê°ì²´ë¥¼ ì™¸ë¶€ë¡œ ë³´ëƒˆë‹¤.

`requestCNContactStoreAccess` ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ì„œ ì²˜ìŒìœ¼ë¡œ íƒˆì¶œ í´ë¡œì €ë¥¼ ì‚¬ìš©í•´ë´¤ë‹¤. ì´ë ‡ê²Œ ì‘ì„±í•˜ë‹ˆ ì½”ë“œê°€ ê¹”ë”í•´ì ¸ì„œ ê°€ë…ì„±ì´ ì¢‹ì•„ì¡Œë‹¤.

ì›ë˜ëŠ” `fetch`ì™€ `request`ë¥¼ ê°™ì´ í•˜ê³  ìˆì—ˆëŠ”ë° ë¦¬íŒ©í† ë§ì„ í•´ì„œ ë©”ì„œë“œë¥¼ ë¶„ë¦¬í–ˆë‹¤.

!["AddressBookApp" Would Like to Access Your Contacts](contacts-6.png)

ì‚¬ìš©ì ìŠ¹ì¸ ìš”ì²­ê³¼ ì—°ë½ì²˜ ì •ë³´ê¹Œì§€ ì˜ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ê·¸ëŸ°ë° ìœ„ ì½”ë“œëŠ” ì´ë¦„ì´ "Appleseed"ì¸ ì‚¬ëŒì˜ ì—°ë½ì²˜ë§Œ ê°–ê³  ì˜¨ë‹¤. ëª¨ë“  ì—°ë½ì²˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ `fetchContacts()` ë©”ì„œë“œë¥¼ ìˆ˜ì •í•´ë³´ì. ê·¸ë¦¬ê³  ê°€ì ¸ì˜¨ ì •ë³´ë¥¼ `CNContact` ë°°ì—´ì— ì €ì¥í•œë‹¤.

```swift
let store = CNContactStore()
var contatcs: Array<CNContact> = []

func fetchContacts() {
    let keysToFetch = [CNContactGivenNameKey, CNContactFamilyNameKey] as [CNKeyDescriptor]
    let request = CNContactFetchRequest(keysToFetch: keysToFetch)

    do {
        try self.store.enumerateContacts(with: request, usingBlock: { (contact, stopPointer) in
            self.contacts.append(contact)
        })
    } catch {
        print("Failed to fetch contact, error: \(error)")
    }
}
```

ì—°ë½ì²˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²Œ ì•„ë‹ˆë¼ `keysToFetch` ì— ìˆëŠ” ê°’ë§Œ ê°–ê³  ì˜¤ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ê°’ì„ ì ì–´ì¤˜ì•¼ í•œë‹¤.

ê·¸ë¦¬ê³  ì§„ì§œ ë§ˆì§€ë§‰ìœ¼ë¡œ.. ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ í…Œì´ë¸”ë·°ë¥¼ í†µí•´ ë¿Œë ¤ì¤€ë‹¤.

```swift
// MARK: - Table view data source
override func numberOfSections(in tableView: UITableView) -> Int {
    // #warning Incomplete implementation, return the number of sections
    return 1
}

override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
    // #warning Incomplete implementation, return the number of rows
    return contacts.count
}

override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
    let cell = tableView.dequeueReusableCell(withpermalink: "cellIdentifier", for: indexPath)

    let contact = contacts[indexPath.row]
    cell.textLabel?.text = contact.familyName
    cell.detailTextLabel?.text = contact.givenName

    return cell
}
```

![Log](contacts-7.png)

ì™„ì„±!

![ì™„ì„± í™”ë©´](contacts-8.png)

ì• í”Œ ê°œë°œì ë¬¸ì„œëŠ” ì§„ì§œ ì˜ ì •ë¦¬ë˜ì–´ìˆë‹¤ëŠ” ê±¸ ë˜ í•œë²ˆ ëŠê¼ˆë‹¤.

## íƒœê·¸

