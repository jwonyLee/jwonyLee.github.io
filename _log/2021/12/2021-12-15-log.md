---
layout: post
title: 2021년 12월 15일 작업일지
subtitle:
published: false
---

## [크롭: 이미 수정한 사진을 다시 원본으로 복구 가능하게 변경](https://github.com/ThingLog/ThingLog/pull/285)

> 추가적으로 미리 선택한 이미지(편집된 상태)들을 다시 잘라서 저장하는 작업이 있는데 이걸 리팩토링하는 과정이 남아있다. 약간 고민 중...

처음에는 별도의 뷰를 만들었다. ScrollView + ImageView 로 구현해서 ImageEditInfo 로 zoomScale과 contentOffset을 세팅해서 뷰를 캡처하는 방식으로 하려했다. 뷰를 캡쳐하는 건 `drawHierarchy` 메서드를 이용해서 하려했는데, 실패한 이유는.. 뭔가 bounds 값이 잘 안 맞아서...? 인 거 같다. 음.. 스크롤 뷰를 캡처하면 이미지가 안 보이고, 다른걸 캡처하면 contentOffset이 안 먹히고 어쩌구 저쩌구의 무한 반복이어서.. 이걸 어제도 붙잡고 오늘도 붙잡았는데 해결을 못하겠더라... 왜.. 왜 안되는거에요...

그래서 생각을 바꿨다. 저렇게 별도의 뷰를 이용해서 하는 경우는 한 번 이상 편집한 경우다. 없으면 원본 이미지에서 크기만 줄이면 되고, 있으면 확대 + 이동을 해야하는건데, 이미 편집 화면에 갔다온 사진들이니까 이전 화면으로 돌아갈 때(여러 사진을 선택하기 위해서) 편집한 사진을 저장하게 변경했다. 그리고 편집 사진이 있으면 해당 사진으로 저장하고, 아니면 원본 사진을 리사이징하게.. 눈물이 앞을 가린다... 