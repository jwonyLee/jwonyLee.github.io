<h1 id="외부-cocoapods-라이브러리-spm-으로-배포하기">외부 Cocoapods 라이브러리 SPM 으로 배포하기</h1>

<h2 id="문제">문제</h2>

<ul>
  <li>회사 프로젝트의 의존성 관리 도구를 전부 Swift Package Manager(이하 SPM)으로 변경하고 싶다.</li>
  <li>SPM 을 지원하지 않는 외부 라이브러리는 어떻게 해야 하지?</li>
</ul>

<h2 id="해결">해결</h2>

<ol>
  <li>github 저장소 생성</li>
  <li>필요한 cocoapods 을 받기 위한 샘플 프로젝트 생성 (이하 SampleProject)</li>
  <li>pod init</li>
  <li>SampleProject/Podfile 에 필요한 cocoapods 라이브러리를 추가</li>
  <li>pod install</li>
  <li>SampleProject/Pods 폴더 안에 내려 받은 라이브러리 폴더에서 {라이브러리}.xcframework 찾기</li>
  <li>해당 파일 압축</li>
  <li>1에서 생성한 github 저장소의 release 에 6번 파일 업로드</li>
  <li>배포할 Package 생성: SamplePackage</li>
  <li>5번에서 압축한 파일을 SamplePackage 최상단으로 이동</li>
  <li>터미널에서 다음 명령어 실행: <code class="language-plaintext highlighter-rouge">swift package compute-checksum ./{라이브러리}.xcframework.zip</code></li>
  <li>Package.swift 파일 수정
```swift
// swift-tools-version: 5.9
// The swift-tools-version declares the minimum version of Swift required to build this package.</li>
</ol>

<p>import PackageDescription</p>

<p>let package = Package(
    name: "{기존 라이브러리와 동일한 이름}",
    platforms: [.iOS(.v12)],
    products: [
        .library(
            name: "{기존 라이브러리와 동일한 이름}",
            targets: ["{기존 라이브러리와 동일한 이름}"]
        ),
    ],
    targets: [
        .binaryTarget(
            name: "{기존 라이브러리와 동일한 이름}",
            url: "{7번에서 업로드한 zip 파일 url}",
            checksum: "{10번에서 얻은 checksum}"
        )
    ]
)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>13. 9번에 추가한 파일은 제거하고 1번에서 만든 저장소에 업로드

이후 다른 패키지에서 dependency 추가할 때

```swift
// swift-tools-version: 5.9
// The swift-tools-version declares the minimum version of Swift required to build this package.

import PackageDescription

let package = Package(
    name: "SPMTest",
    products: [
        .library(
            name: "SPMTest",
            targets: ["SPMTest"]
        )
    ],
    dependencies: [
        .package(url: "{1번 저장소 주소}.git", branch: "main") // branch, upToNextMajor 등 상관 없음
    ],
    targets: [
        .target(
            name: "SPMTest",
            dependencies: [
                .product(name: "{기존 라이브러리 이름}", package: "{1번 저장소 이름}") // package 이름을 라이브러리 이름과 동일하게 작성했을 때 동작하지 않았음
            ]
        )
    ]
)

</code></pre></div></div>

<h2 id="그-외">그 외</h2>

<ul>
  <li>외부 라이브러리가 소스 파일을 공개하는 경우에는 위 방식과 다르게 구성. 해당 부분은 다른 블로그의 SPM 배포 참고</li>
  <li>이렇게 구성했을 때의 단점은 라이브러리의 버전을 수동으로 관리해줘야 한다는 단점이 있음. 관리 포인트가 늘어남.
    <ul>
      <li>하지만 외부 라이브러리에서 SPM 을 지원할 계획이 없다면 괜찮은 선택이라고 생각함.</li>
    </ul>
  </li>
</ul>

<h2 id="참고-자료">참고 자료</h2>

<ul>
  <li><a href="https://stackoverflow.com/questions/68529771/how-can-i-get-checksum-for-a-binary-package">swift - How can I get checksum for a Binary Package? - Stack Overflow</a></li>
  <li><a href="https://developer.apple.com/videos/play/wwdc2020/10147">Distribute binary frameworks as Swift packages - WWDC20 - Videos - Apple Developer</a></li>
  <li><a href="https://github.com/stleamist/NMapsMap-SwiftPM">stleamist/NMapsMap-SwiftPM: SwiftPM을 지원하는 iOS용 네이버 지도 SDK의 비공식 미러 저장소</a></li>
</ul>
