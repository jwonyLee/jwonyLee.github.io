<h1 id="ios-contacts-í”„ë ˆì„ì›Œí¬-í†ºì•„ë³´ê¸°">[iOS] Contacts í”„ë ˆì„ì›Œí¬ í†ºì•„ë³´ê¸°</h1>

<h2 id="ê°œìš”">ê°œìš”</h2>

<p><a href="https://developer.apple.com/documentation/contacts">Contacts</a> í”„ë ˆì„ì›Œí¬ í†ºì•„ë³´ê¸°</p>

<p>Contacts í”„ë ˆì„ì›Œí¬ ë¬¸ì„œë¥¼ ì°¸ê³ í•´ì„œ ì‚¬ìš©ìì˜ ì—°ë½ì²˜ë¥¼ ê°€ì ¸ì™€ì„œ í…Œì´ë¸”ë·°ë¥¼ í†µí•´ ë³´ì—¬ì£¼ì.</p>

<h2 id="-ì‚¬ìš©ìì˜-ì—°ë½ì²˜ë¥¼-ê°€ì ¸ì™€ì„œ-ë³´ì—¬ì£¼ê¸°">ğŸ”¨ ì‚¬ìš©ìì˜ ì—°ë½ì²˜ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì£¼ê¸°</h2>

<p>UI êµ¬ì„±í•˜ëŠ” ë¶€ë¶„ì€ íŒ¨ìŠ¤. ì½”ë“œë‚˜ ìŠ¤í† ë¦¬ë³´ë“œë¡œ í…Œì´ë¸”ë·°ì™€ ì…€ êµ¬ì„±ì„ í•´ì£¼ë©´ ëœë‹¤. ì…€ì˜ ìŠ¤íƒ€ì¼ì€ <code class="language-plaintext highlighter-rouge">Subtitle</code>ë¡œ ì§€ì •í•´ì¤¬ë‹¤. ë°ì´í„°ë¥¼ ë§ì´ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì¤„ ê²Œ ì•„ë‹ˆë¼ì„œ ê°„ë‹¨í•˜ê²Œ í–ˆë‹¤.</p>

<p>ê·¸ë‹¤ìŒìœ¼ë¡œ Fetching Contacts ë¬¸ë‹¨ì— ìˆëŠ” ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¼ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

    <span class="k">self</span><span class="o">.</span><span class="nf">fetchContacts</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">fetchContacts</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">CNContactStore</span><span class="p">()</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">predicate</span> <span class="o">=</span> <span class="kt">CNContact</span><span class="o">.</span><span class="nf">predicateForContacts</span><span class="p">(</span><span class="nv">matchingName</span><span class="p">:</span> <span class="s">"Appleseed"</span><span class="p">)</span>
                <span class="k">let</span> <span class="nv">keysToFetch</span> <span class="o">=</span> <span class="p">[</span><span class="kt">CNContactGivenNameKey</span><span class="p">,</span> <span class="kt">CNContactFamilyNameKey</span><span class="p">]</span> <span class="k">as</span> <span class="p">[</span><span class="kt">CNKeyDescriptor</span><span class="p">]</span>
        <span class="k">let</span> <span class="nv">contacts</span> <span class="o">=</span>
            <span class="k">try</span> <span class="n">store</span><span class="o">.</span><span class="nf">unifiedContacts</span><span class="p">(</span><span class="nv">matching</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="nv">keysToFetch</span><span class="p">:</span> <span class="n">keysToFetch</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Fetched contacts: </span><span class="se">\(</span><span class="n">contacts</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Failed to fetch contact, error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="c1">// Handle the error</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="contacts-1.png" alt="Error Message" /></p>

<p>ì‹¤í–‰í•´ë³´ë©´ ìœ„ì™€ ê°™ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ì™œëƒí•˜ë©´ ì—°ë½ì²˜ëŠ” ê°œì¸ì •ë³´ì— í•´ë‹¹í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ìš”ì²­ë°›ì•„ì•¼ í•œë‹¤.</p>

<p><img src="contacts-2.png" alt="Contacts Topics" /></p>

<p>Contacts ë¬¸ì„œ í•˜ë‹¨ì—ëŠ” ê´€ë ¨ëœ í† í”½ì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ <a href="https://developer.apple.com/documentation/contacts/requesting_authorization_to_access_contacts">Requesting Authorization to Access Contacts</a> ë¬¸ì„œë¥¼ ë³´ë©´ ëœë‹¤.</p>

<p><img src="contacts-3.png" alt="Requesting Authorization to Access Contacts" /></p>

<p>ì˜ì–´ë§Œ ë´ë„ ëˆˆì´ í•‘ ëŒì•„ê°„ë‹¤. @_@â€¦</p>

<p>ì•±ì€ ì‚¬ìš©ìê°€ ê¶Œí•œì„ ë¶€ì—¬í•  ë•Œê¹Œì§€ ì—°ë½ì²˜ í•­ëª©ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ë‹¤ê³  ì„¤ëª…í•˜ë©´ì„œ ì‚¬ìš©ìì—ê²Œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">authorizationStatus(for:)</code> ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë¼ê³  ì“°ì—¬ìˆë‹¤.</p>

<p><img src="contacts-4.png" alt="Configure Your Information Property List File" /></p>

<p>ì¡°ê¸ˆ ë” ë°‘ìœ¼ë¡œ ë‚´ë ¤ì„œ ì½ì–´ë³´ë©´, <code class="language-plaintext highlighter-rouge">Info.plist</code> íŒŒì¼ì— <code class="language-plaintext highlighter-rouge">NSContactsUsageDescription</code> í‚¤ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤ê³  ì“°ì—¬ìˆë‹¤. ì´ í‚¤ì˜ ê°’ì€ ì•±ì´ ì‚¬ìš©ìì˜ ì—°ë½ì²˜ë¡œ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ì„ ì„¤ëª…í•˜ëŠ” ë¬¸ìì—´ì´ë¼ê³  í•œë‹¤.</p>

<p>ê·¸ë¦¬ê³  ê·¸ ë‹¤ìŒìœ¼ë¡œëŠ” ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ìŠ¹ì¸ ìš”ì²­ì„ í•˜ëŠ” ë°©ë²•ì´ ì“°ì—¬ìˆë‹¤. <code class="language-plaintext highlighter-rouge">requestAccess(for:completionHandler:)</code> ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤ê³  í•œë‹¤. í•„ìš”í•œ ì •ë³´ë¥¼ ì „ë¶€ ì•Œì•„ëƒˆìœ¼ë‹ˆ ë¬¸ì œë¥¼ ë¬¸ì„œì—ì„œ ì œì‹œí•˜ëŠ” ëŒ€ë¡œ ì•±ì„ ìˆ˜ì •í•´ë³¸ë‹¤.</p>

<p>ë¨¼ì € <code class="language-plaintext highlighter-rouge">Info.plist</code> íŒŒì¼ì— <code class="language-plaintext highlighter-rouge">NSContactsUsageDescription</code> í‚¤ë¥¼ ì¶”ê°€í•´ì•¼ í•˜ëŠ”ë°, ì´ê²ƒë§Œ ë´ì„  ë­”ì§€ ëª¨ë¥¼ ê±° ê°™ì§€ë§Œ ì• í”Œì—ì„  ì¹œì ˆí•˜ê²Œ í•´ë‹¹ í‚¤ê°€ ì‹¤ì œë¡œ ë¬´ìŠ¨ ì´ë¦„ì„ ê°€ì¡ŒëŠ”ì§€ ë¬¸ì„œë¡œ ì œê³µí•˜ê³  ìˆë‹¤.</p>

<p><a href="https://developer.apple.com/documentation/bundleresources/information_property_list/nscontactsusagedescription">https://developer.apple.com/documentation/bundleresources/information_property_list/nscontactsusagedescription</a></p>

<p><img src="contacts-5.png" alt="NSContactsUsageDescription" /></p>

<p><code class="language-plaintext highlighter-rouge">Info.plist</code>ì— ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•´ì¤€ë‹¤. ì‚¬ìš©ìì—ê²Œ ì´ ê¶Œí•œì´ ì™œ í•„ìš”í•œì§€ ì„¤ëª…ì„ ê¸°ë¡í•´ì•¼ í•œë‹¤.</p>

<p>ì´ë ‡ê²Œ í•œ ë‹¤ìŒì— ë°”ë¡œ ì—°ë½ì²˜ì— ì ‘ê·¼í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ <code class="language-plaintext highlighter-rouge">requestAccess(for:completionHandler:)</code>ë¥¼ ì´ìš©í•´ ì‚¬ìš©ìì—ê²Œ ìŠ¹ì¸ ìš”ì²­ì„ í•œë‹¤. ê¶Œí•œì´ ìˆìœ¼ë©´ ì—°ë½ì²˜ì— ì ‘ê·¼í•˜ê³ , ì—†ìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œ ìš”ì²­ì„ í•œë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">CNContactStore</span><span class="p">()</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

    <span class="k">self</span><span class="o">.</span><span class="n">requestCNContactStoreAccess</span> <span class="p">{</span>
        <span class="c1">// ìŠ¹ì¸ ìš”ì²­ ì„±ê³µì‹œ í•  ì‘ì—…</span>
        <span class="nf">fetchContacts</span><span class="p">()</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">requestCNContactStoreAccess</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="nf">requestAccess</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">contacts</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">granted</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// ì—ëŸ¬ ë°œìƒ</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="c1">// ì‚¬ìš©ìì—ê²Œ ìŠ¹ì¸ ìš”ì²­ ì„±ê³µì‹œ íƒˆì¶œ</span>
        <span class="k">if</span> <span class="n">granted</span> <span class="p">{</span>
            <span class="nf">completion</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì´ ê³¼ì •ì—ì„œ <code class="language-plaintext highlighter-rouge">fetchContacts</code>ì— ìˆë˜ <code class="language-plaintext highlighter-rouge">store</code> ê°ì²´ë¥¼ ì™¸ë¶€ë¡œ ë³´ëƒˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">requestCNContactStoreAccess</code> ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ì„œ ì²˜ìŒìœ¼ë¡œ íƒˆì¶œ í´ë¡œì €ë¥¼ ì‚¬ìš©í•´ë´¤ë‹¤. ì´ë ‡ê²Œ ì‘ì„±í•˜ë‹ˆ ì½”ë“œê°€ ê¹”ë”í•´ì ¸ì„œ ê°€ë…ì„±ì´ ì¢‹ì•„ì¡Œë‹¤.</p>

<p>ì›ë˜ëŠ” <code class="language-plaintext highlighter-rouge">fetch</code>ì™€ <code class="language-plaintext highlighter-rouge">request</code>ë¥¼ ê°™ì´ í•˜ê³  ìˆì—ˆëŠ”ë° ë¦¬íŒ©í† ë§ì„ í•´ì„œ ë©”ì„œë“œë¥¼ ë¶„ë¦¬í–ˆë‹¤.</p>

<p><img src="contacts-6.png" alt="&quot;AddressBookApp&quot; Would Like to Access Your Contacts" /></p>

<p>ì‚¬ìš©ì ìŠ¹ì¸ ìš”ì²­ê³¼ ì—°ë½ì²˜ ì •ë³´ê¹Œì§€ ì˜ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p>ê·¸ëŸ°ë° ìœ„ ì½”ë“œëŠ” ì´ë¦„ì´ "Appleseed"ì¸ ì‚¬ëŒì˜ ì—°ë½ì²˜ë§Œ ê°–ê³  ì˜¨ë‹¤. ëª¨ë“  ì—°ë½ì²˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ <code class="language-plaintext highlighter-rouge">fetchContacts()</code> ë©”ì„œë“œë¥¼ ìˆ˜ì •í•´ë³´ì. ê·¸ë¦¬ê³  ê°€ì ¸ì˜¨ ì •ë³´ë¥¼ <code class="language-plaintext highlighter-rouge">CNContact</code> ë°°ì—´ì— ì €ì¥í•œë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">CNContactStore</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">contatcs</span><span class="p">:</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">CNContact</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kd">func</span> <span class="nf">fetchContacts</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">keysToFetch</span> <span class="o">=</span> <span class="p">[</span><span class="kt">CNContactGivenNameKey</span><span class="p">,</span> <span class="kt">CNContactFamilyNameKey</span><span class="p">]</span> <span class="k">as</span> <span class="p">[</span><span class="kt">CNKeyDescriptor</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">CNContactFetchRequest</span><span class="p">(</span><span class="nv">keysToFetch</span><span class="p">:</span> <span class="n">keysToFetch</span><span class="p">)</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="nf">enumerateContacts</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="nv">usingBlock</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">contact</span><span class="p">,</span> <span class="n">stopPointer</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">contact</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Failed to fetch contact, error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì—°ë½ì²˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ëª¨ë“  ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²Œ ì•„ë‹ˆë¼ <code class="language-plaintext highlighter-rouge">keysToFetch</code> ì— ìˆëŠ” ê°’ë§Œ ê°–ê³  ì˜¤ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ê°’ì„ ì ì–´ì¤˜ì•¼ í•œë‹¤.</p>

<p>ê·¸ë¦¬ê³  ì§„ì§œ ë§ˆì§€ë§‰ìœ¼ë¡œ.. ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ í…Œì´ë¸”ë·°ë¥¼ í†µí•´ ë¿Œë ¤ì¤€ë‹¤.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - Table view data source</span>
<span class="k">override</span> <span class="kd">func</span> <span class="nf">numberOfSections</span><span class="p">(</span><span class="k">in</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="c1">// #warning Incomplete implementation, return the number of sections</span>
    <span class="k">return</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
    <span class="c1">// #warning Incomplete implementation, return the number of rows</span>
    <span class="k">return</span> <span class="n">contacts</span><span class="o">.</span><span class="n">count</span>
<span class="p">}</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withpermalink</span><span class="p">:</span> <span class="s">"cellIdentifier"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">textLabel</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">contact</span><span class="o">.</span><span class="n">familyName</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">detailTextLabel</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">contact</span><span class="o">.</span><span class="n">givenName</span>

    <span class="k">return</span> <span class="n">cell</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="contacts-7.png" alt="Log" /></p>

<p>ì™„ì„±!</p>

<p><img src="contacts-8.png" alt="ì™„ì„± í™”ë©´" /></p>

<p>ì• í”Œ ê°œë°œì ë¬¸ì„œëŠ” ì§„ì§œ ì˜ ì •ë¦¬ë˜ì–´ìˆë‹¤ëŠ” ê±¸ ë˜ í•œë²ˆ ëŠê¼ˆë‹¤.</p>

<h2 id="íƒœê·¸">íƒœê·¸</h2>

<p>#iOS/Contacts</p>
