<h1 id="ios-uimenu-사용해보기">[iOS] UIMenu 사용해보기</h1>

<p>![[uimenu.png]]</p>

<p>Apple의 미리 알림 앱 화면이다. 내비게이션 우측 상단 버튼을 탭 하면 해당 위치에 메뉴 목록이 나타난다. 지금 하고 있는 프로젝트에 이 메뉴를 적용하고 싶어서 찾아봤는데, ActionSheet를 사용하라는 얘기가 많았다. 그래서 <code class="language-plaintext highlighter-rouge">UIAlertController</code>를 사용했는데, 원하는 화면이 나오지 않았다.</p>

<p>알고보니, <code class="language-plaintext highlighter-rouge">UIAlertController(.actionSheet)</code>는 iPad에서는 위와 같이, 탭한 위치에 팝업? 모달? 형태로 나오고, iOS에서는 기존에 흔히 알고 있는 액션 시트 형태로 나온다더라. 애플에서 오픈하지도 않은 기능을 쓰진 않을 텐데 라는 생각을 해서 개발자 문서를 다시 찾아보니, <code class="language-plaintext highlighter-rouge">UIMenu</code>라고 부른다는 것을 알았다. 유..유레카!</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">menuItems</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIAction</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">return</span> <span class="p">[</span>
		<span class="kt">UIAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">I18N</span><span class="o">.</span><span class="n">modify</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"pencil"</span><span class="p">),</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="p">}),</span>
		<span class="kt">UIAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">I18N</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"trash"</span><span class="p">),</span> <span class="nv">attributes</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="p">})</span>
	<span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">UIMenu</code>는 여러 개의 <code class="language-plaintext highlighter-rouge">UIAction</code>을 갖고 있다. <code class="language-plaintext highlighter-rouge">UIAlertController</code>가 <code class="language-plaintext highlighter-rouge">UIAlertAction</code>을 갖고 있는 것과 비슷하다. <code class="language-plaintext highlighter-rouge">handler</code>에는 해당 메뉴 아이템을 탭 했을 때 어떠한 동작을 처리할 것인지 작성하면 되는데, 빈 값이라도 무조건 써야 한다. <code class="language-plaintext highlighter-rouge">handler: nil</code>이나 아예 <code class="language-plaintext highlighter-rouge">handler</code>를 지워봤는데, 오류가 뜬다.</p>

<p><code class="language-plaintext highlighter-rouge">UIMenu</code>는 <code class="language-plaintext highlighter-rouge">UIKeyCommand</code>도 가질 수 있는데, 이는 macOS, iPadOS에서 키보드를 사용할 때 단축키로 접근할 수 있게 하는 컴포넌트다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">menu</span><span class="p">:</span> <span class="kt">UIMenu</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kt">UIMenu</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">permalink</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[],</span> <span class="nv">children</span><span class="p">:</span> <span class="n">menuItems</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이렇게 <code class="language-plaintext highlighter-rouge">UIAction</code> 목록을 만들고 나서, <code class="language-plaintext highlighter-rouge">UIMenu</code>에 담아주자. 맨 처음 참고했던 문사는 위의 코드처럼 연산 프로퍼티로 작성하는데, Apple 문서를 보면 굳이 연산 프로퍼티로 작성하지 않아도 되는 거 같다.</p>

<p>미리 알림 앱처럼 내비게이션 바 아이템으로 동작하게 하고 싶으면, <code class="language-plaintext highlighter-rouge">UIMenu</code>를 <code class="language-plaintext highlighter-rouge">UIBarButtonItem</code>에 담아서 <code class="language-plaintext highlighter-rouge">navigationItem.rightBarButtonItem</code>으로 넣어주면 된다.</p>

<p>아쉽게도 <code class="language-plaintext highlighter-rouge">UIMenu</code>는 iOS 14.0 버전 이상부터 지원한다. 그래서 나는 분기를 나눠서, iOS 14.0 버전 이하면 <code class="language-plaintext highlighter-rouge">UIAlertController(.actionSheet)</code>를 보여주기로 했다.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="k">#available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">14.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">navigationItem</span><span class="o">.</span><span class="n">rightBarButtonItem</span> <span class="o">=</span> <span class="kt">UIBarButtonItem</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span>
                                                             <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"ellipsis.circle"</span><span class="p">),</span>
                                                             <span class="nv">primaryAction</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
                                                             <span class="nv">menu</span><span class="p">:</span> <span class="n">menu</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">navigationItem</span><span class="o">.</span><span class="n">rightBarButtonItem</span> <span class="o">=</span> <span class="kt">UIBarButtonItem</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"ellipsis.circle"</span><span class="p">),</span>
                                                             <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">plain</span><span class="p">,</span>
                                                             <span class="nv">target</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span>
                                                             <span class="nv">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">moreActionTapped</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">moreActionTapped</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UIBarButtonItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">alert</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">I18N</span><span class="o">.</span><span class="n">actionsheetMessage</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">actionSheet</span><span class="p">)</span>

    <span class="k">let</span> <span class="nv">deleteAction</span> <span class="o">=</span> <span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">I18N</span><span class="o">.</span><span class="n">modify</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="p">})</span>
    <span class="k">let</span> <span class="nv">saveAction</span> <span class="o">=</span> <span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">I18N</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="p">})</span>
    <span class="k">let</span> <span class="nv">cancelAction</span> <span class="o">=</span> <span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">I18N</span><span class="o">.</span><span class="n">cancle</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">cancel</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="p">})</span>

    <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">deleteAction</span><span class="p">)</span>
    <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">saveAction</span><span class="p">)</span>
    <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="n">cancelAction</span><span class="p">)</span>

    <span class="k">self</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="n">alert</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>iOS 14.0</th>
      <th>iOS 13.0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>![[ios14.png]]</td>
      <td>![[ios13.png]]</td>
    </tr>
  </tbody>
</table>

<p>끝!</p>

<h2 id="참고-자료">참고 자료</h2>

<ul>
  <li><a href="https://nemecek.be/blog/85/how-to-show-uimenu-from-uibutton-or-uibarbuttonitem">How to show UIMenu from UIButton or UIBarButtonItem</a></li>
  <li><a href="https://developer.apple.com/documentation/uikit/uicommand/adding_menus_and_shortcuts_to_the_menu_bar_and_user_interface">Adding Menus and Shortcuts to the Menu Bar and User Interface</a></li>
  <li><a href="https://developer.apple.com/documentation/uiki.">UIMenu - Apple Developer Documentation</a></li>
</ul>

<h2 id="태그">태그</h2>

<p>#iOS/UIMenu</p>
