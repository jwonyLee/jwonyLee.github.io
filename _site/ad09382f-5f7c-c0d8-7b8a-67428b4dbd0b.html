<h1 id="ios-gcd-api-동작-방식과-필요성에-대해-설명하시오">[iOS] GCD API 동작 방식과 필요성에 대해 설명하시오.</h1>

<p><strong>동작 방식</strong></p>

<p>해야 할 일(코드)을 Operation으로 Wrapping한 다음에, Queue에 넣는다. Queue에서 남는 스레드에 작업을 배분한다.</p>

<p><strong>필요성</strong></p>

<p>웹에서 이미지를 다운 받아서 사용자에게 보여준다고 했을 때, 비동기로 처리하지 않는다면 이미지를 다운받는 동안 다른 작업을 할 수 없기 때문에 앱이 멈춘다. 이렇게 비용이 많이 들어가는? 작업을 메인 스레드에서 진행하면 사용자가 다른 작업을 할 수 없기 때문에 필요하다고 생각한다.</p>

<hr />

<h2 id="dispatchqueue">DispatchQueue</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">DispatchQueue</span><span class="p">:</span> <span class="kt">DispatchObject</span>
</code></pre></div></div>

<p>DispatchQueue는 애플리케이션이 블록 객체 형태로 작업을 제출할 수 있는 FIFO Queue</p>

<ul>
  <li>DispatchQueue는 작업을 직렬 또는 동시에 실행함</li>
  <li>DispatchQueue에 제출된 작업은 시스템에서 관리하는 스레드 풀에서 실행됨</li>
  <li>앱의 기본 스레드를 나타내는 DispatchQueue를 제외하고 시스템은 작업을 실행하는 데 사용하는  스레드에 대해 보장하지 않음</li>
</ul>

<p>main queue에서 작업 항목을 동기적으로 실행하려고 하면 교착 상태(deadlock)가 발생</p>

<h3 id="동작-방식">동작 방식</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
	<span class="nf">print</span><span class="p">(</span><span class="s">"main sync"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">DispatchQueue.main</code></p>

<ul>
  <li>main thread queue</li>
  <li>기본적으로 Serial Queue(직렬 큐)로 동작</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">DisptchQueue.global</code></p>

<ul>
  <li>background thread queue</li>
  <li>기본적으로 Concurrent Queue(병렬 큐)로 동작</li>
  <li><code class="language-plaintext highlighter-rouge">QoS</code>를 이용해 우선 순위를 정해줄 수 있음
    <ul>
      <li>User-interactive: 즉시 완료해야하는 작업을 나타냄. UI 업데이트, 이벤트 처리 등에 사용. 메인 스레드에서 실행되어야 함.</li>
      <li>User-initiated: 사용자 상호 작용을 계속하는 데 필요한 작업을 기다리고 있을 때 사용.</li>
      <li>Utility: 사용자에게 표시되는 진행률 표시가 있는 장기 실행 작업을 나타냄. 계산, I/O, 네트워킹, 연속 데이터 피드 및 유사한 작업에 사용. 우선 순위가 낮은 글로벌 큐에 매핑</li>
      <li>Background: 사용자가 직접 알지 못하는 작업을 나타냄. 유저 관리 및 사용자 상호 작용이 필요하지 않고 시간에 민감하지 않은 기타 작업에 사용.</li>
    </ul>
  </li>
</ul>

<p>작업을 main 스레드 혹은 global 스레드에서 할 지와 동기, 비동기를 지정하여 <code class="language-plaintext highlighter-rouge">DispatchQueue</code>에 보낸다. 이렇게 보내진 작업은 시스템에 의해 각 스레드로 보내져서 작업이 이루어진다.</p>

<h3 id="필요성">필요성</h3>

<p>기존에 스레드를 사용하려면 개발자가 직접 스레드를 생성하고 관리해야 했다. GCD를 사용하면 스레드 생성, 유지, 삭제 등을 개발자가 신경쓸 필요 없이 해야할 작업(코드)를 큐에 예약하기만 하면 된다.</p>

<hr />

<h2 id="참고-자료">참고 자료</h2>
<ul>
  <li><a href="https://developer.apple.com/documentation/dispatch">Dispatch - Apple Developer Documentation</a></li>
  <li><a href="https://developer.apple.com/documentation/dispatch/dispatchqueue">DispatchQueue - Apple Developer Documentation</a></li>
  <li><a href="https://www.raywenderlich.com/5370-grand-central-dispatch-tutorial-for-swift-4-part-1-2">Grand Central Dispatch Tutorial for Swift 4: Part 1/2</a></li>
  <li><a href="https://ginjo.tistory.com/16">[Swift] GCD (Grand Central Dispatch)</a></li>
</ul>

<h2 id="태그">태그</h2>

<p>#iOS #iOSInterviewquestions</p>
